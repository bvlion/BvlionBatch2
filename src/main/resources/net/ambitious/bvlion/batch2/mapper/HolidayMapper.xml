<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="net.ambitious.bvlion.batch2.mapper.HolidayMapper">

    <select id="isSetHoliday" resultType="_boolean">
        SELECT
          CASE WHEN COUNT(*) > 0
            THEN 1
            ELSE 0
          END
        FROM
          holidays
        WHERE
          check_date = DATE_ADD(CURRENT_DATE(), INTERVAL 1 DAY)
    </select>

    <select id="nextDayStatusCheck" resultType="_int">
        SELECT
          CASE WHEN
              (SELECT holiday FROM holidays WHERE check_date = date(NOW()))
              =
              (SELECT holiday FROM holidays WHERE check_date = DATE_ADD(CURRENT_DATE(), INTERVAL 1 DAY))
            THEN 0
            ELSE
              CASE WHEN (SELECT holiday FROM holidays WHERE check_date = date(NOW())) = 0
                THEN 1
                ELSE 2
              END
          END
        FROM DUAL
    </select>

    <select id="isHoliday" resultType="_boolean">
        SELECT
            holiday
        FROM
            holidays
        WHERE
            check_date = date(NOW())
    </select>

    <update id="setHoliday">
        INSERT INTO holidays
          (check_date, holiday)
        VALUES
          (#{date}, #{holiday})
        ON DUPLICATE KEY UPDATE
          holiday = #{holiday}
    </update>
</mapper>
